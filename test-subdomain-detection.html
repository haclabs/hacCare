<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subdomain Detection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .code {
            background: #e9ecef;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Subdomain Detection Test</h1>
        <p>This test simulates the subdomain detection logic from the hacCare application.</p>
        
        <div id="results"></div>
        
        <h2>üîß Manual Test</h2>
        <label for="testUrl">Test URL:</label>
        <input type="text" id="testUrl" placeholder="lethpoly.haccare.app" style="width: 300px; padding: 5px;">
        <button onclick="testCustomUrl()" style="padding: 5px 10px;">Test</button>
        
        <div id="customResults"></div>
    </div>

    <script>
        // Simulate the subdomain detection function from subdomainService.ts
        function getCurrentSubdomain(hostname = window.location.hostname) {
            // Handle localhost and development environments
            if (hostname === 'localhost' || hostname.includes('127.0.0.1') || hostname.includes('.local')) {
                return null;
            }

            // Split hostname into parts
            const parts = hostname.split('.');
            
            // Need at least 3 parts for subdomain (subdomain.domain.com)
            if (parts.length < 3) {
                return null;
            }

            // Return the first part as subdomain (unless it's 'www')
            const subdomain = parts[0];
            return subdomain === 'www' ? null : subdomain;
        }

        function displayResult(container, hostname, subdomain, isProduction = false) {
            const result = document.createElement('div');
            result.className = subdomain ? 'result success' : 'result error';
            
            const env = isProduction ? 'Production' : 'Development';
            const envNote = isProduction ? '' : ' (would return null in dev mode)';
            
            result.innerHTML = `
                <strong>${env} Test:</strong><br>
                URL: <code>${hostname}</code><br>
                Detected subdomain: <code>${subdomain || 'null'}</code>${envNote}<br>
                Parts: <code>[${hostname.split('.').map(p => `"${p}"`).join(', ')}]</code>
            `;
            
            container.appendChild(result);
        }

        function runTests() {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '<h2>üß™ Test Results</h2>';

            // Current URL test
            const currentHostname = window.location.hostname;
            const currentSubdomain = getCurrentSubdomain(currentHostname);
            displayResult(resultsContainer, currentHostname, currentSubdomain);

            // Test cases
            const testCases = [
                'lethpoly.haccare.app',
                'www.haccare.app', 
                'demo.haccare.app',
                'hospital1.haccare.app',
                'haccare.app',
                'localhost:5173',
                'admin.demo.haccare.app'
            ];

            testCases.forEach(hostname => {
                const subdomain = getCurrentSubdomain(hostname);
                displayResult(resultsContainer, hostname, subdomain, true);
            });
        }

        function testCustomUrl() {
            const testUrl = document.getElementById('testUrl').value.trim();
            const customResults = document.getElementById('customResults');
            
            if (!testUrl) {
                customResults.innerHTML = '<div class="result error">Please enter a URL to test.</div>';
                return;
            }

            // Remove protocol if present
            const hostname = testUrl.replace(/^https?:\/\//, '').split('/')[0];
            const subdomain = getCurrentSubdomain(hostname);
            
            customResults.innerHTML = '';
            displayResult(customResults, hostname, subdomain, true);
        }

        // Run tests on page load
        runTests();

        // Pre-fill the test input with lethpoly.haccare.app
        document.getElementById('testUrl').value = 'lethpoly.haccare.app';
    </script>
</body>
</html>
