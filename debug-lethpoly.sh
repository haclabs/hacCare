# LethPoly Subdomain Troubleshooting Guide
# For haccare.app ‚Üí lethpoly.haccare.app

echo "üîß LethPoly Subdomain Troubleshooting"
echo "====================================="
echo ""

echo "üìç Your Configuration:"
echo "  Primary Domain: haccare.app"
echo "  Tenant Subdomain: lethpoly.haccare.app"
echo "  Expected Result: LethPoly tenant should load"
echo ""

echo "‚úÖ Step 1: Verify DNS Resolution"
echo "  Run these commands to test DNS:"
echo "  ‚Ä¢ curl -I https://haccare.app"
echo "  ‚Ä¢ curl -I https://lethpoly.haccare.app"
echo ""

echo "‚úÖ Step 2: Check Netlify Configuration"
echo "  In Netlify Dashboard:"
echo "  1. Domain Settings ‚Üí Custom domains"
echo "     ‚Ä¢ Add: haccare.app"
echo "     ‚Ä¢ Add: *.haccare.app"
echo "  2. SSL/TLS ‚Üí Verify both domains have SSL"
echo "  3. Build & Deploy ‚Üí Environment variables:"
echo "     ‚Ä¢ NODE_ENV=production"
echo "     ‚Ä¢ VITE_PRODUCTION_DOMAIN=haccare.app"
echo "     ‚Ä¢ VITE_SUBDOMAIN_ROUTING_ENABLED=true"
echo ""

echo "‚úÖ Step 3: Verify Database Setup"
echo "  Run in Supabase SQL Editor:"
echo "  SELECT name, subdomain, status FROM tenants WHERE subdomain = 'lethpoly';"
echo ""

echo "‚úÖ Step 4: Test Subdomain Routing"
echo "  1. Open browser dev tools (F12)"
echo "  2. Go to https://lethpoly.haccare.app"
echo "  3. Check Console for messages like:"
echo "     'üè¢ Tenant subdomain detected: lethpoly'"
echo "  4. Check Network tab for failed requests"
echo ""

echo "üêõ Common Issues & Fixes:"
echo ""
echo "  Issue: 'Page cannot be displayed'"
echo "  ‚Üí Check DNS propagation (up to 48 hours)"
echo "  ‚Üí Verify wildcard DNS record: *.haccare.app"
echo ""
echo "  Issue: Main domain works, subdomain doesn't"
echo "  ‚Üí Add *.haccare.app to Netlify domains"
echo "  ‚Üí Check netlify.toml redirects"
echo ""
echo "  Issue: SSL certificate errors"
echo "  ‚Üí Ensure SSL enabled for *.haccare.app in Netlify"
echo "  ‚Üí Check certificate covers wildcard domains"
echo ""
echo "  Issue: Tenant not found errors"
echo "  ‚Üí Run lethpoly-tenant-setup.sql"
echo "  ‚Üí Verify subdomain = 'lethpoly' in database"
echo ""

echo "üîç Debug Commands:"
echo "  # Test main domain"
echo "  curl -v https://haccare.app"
echo ""
echo "  # Test subdomain"
echo "  curl -v https://lethpoly.haccare.app"
echo ""
echo "  # Check DNS"
echo "  nslookup lethpoly.haccare.app"
echo ""
echo "  # Test local build"
echo "  npm run build && npm run preview"
echo ""

echo "üìã Deployment Checklist:"
echo "  ‚ñ° netlify.toml updated with haccare.app"
echo "  ‚ñ° Environment variables set in Netlify"
echo "  ‚ñ° DNS wildcard record: *.haccare.app"
echo "  ‚ñ° Custom domain added: haccare.app"
echo "  ‚ñ° Wildcard domain added: *.haccare.app"
echo "  ‚ñ° SSL enabled for both domains"
echo "  ‚ñ° production-subdomain-setup.sql executed"
echo "  ‚ñ° lethpoly-tenant-setup.sql executed"
echo "  ‚ñ° Build successful and deployed"
echo ""

echo "üöÄ Quick Test:"
echo "  1. https://haccare.app - Should load main app"
echo "  2. https://lethpoly.haccare.app - Should show LethPoly tenant"
echo "  3. Browser console should show: 'üè¢ Tenant subdomain detected: lethpoly'"
